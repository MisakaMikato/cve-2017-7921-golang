package aesebc

import (
	"strings"
	"testing"
)

func TestAES(t *testing.T) {
	testStr1 := []byte("hellworld!")
	testStr2 := []byte("因项目中go程序与java程序需要传输一些加密数据，以下为整理后的Aes(CBC模式)加密解密方法，因java中aes所用的填充算法为PKCS5padding(具体内容可自行查阅)，所以在本示例中也采用PKCS5padding")
	testKey := []byte("1234567890qwerty")

	cases := []struct {
		first    []byte
		excepted []byte
	}{
		{AesEncrypt(testStr1, testKey), testStr1},
		{AesEncrypt(testStr2, testKey), testStr2},
	}

	for _, c := range cases {
		result := AesDecrypt(c.first, testKey)
		if strings.Compare(string(c.excepted), string(result)) != 0 {
			t.Fatalf("length of first: %d, length of result: %d", len(c.first), len(result))
		}
	}
}

func TestZeroPadding(t *testing.T) {
	testStr1 := "123456789"
	testStr2 := "1234567890qwertyu"
	testStr3 := "1234567890qwerty"

	cases := []struct {
		origData       []byte
		exceptedLength int
	}{
		{[]byte(testStr1), 16},
		{[]byte(testStr2), 16},
		{[]byte(testStr2), 32},
		{[]byte(testStr3), 16},
	}

	for _, c := range cases {
		result := ZeroPadding(c.origData, c.exceptedLength)
		if len(result)%c.exceptedLength != 0 {
			t.Fatalf(
				"ZeroPadding function failed, origDataLength: %d, execptedLength:%d, resultLength:%d",
				len(c.origData),
				c.exceptedLength,
				len(result))
		}
	}
	t.Log("ZeroPadding function pass.")
}

func TestZeroUnPadding(t *testing.T) {
	testStr1 := "123456789"
	testStr2 := "1234567890qwertyu"
	testStr3 := "1234567890qwerty"

	testCase1 := ZeroPadding([]byte(testStr1), 16)
	testCase2 := ZeroPadding([]byte(testStr2), 16)
	testCase3 := ZeroPadding([]byte(testStr2), 32)
	testCase4 := ZeroPadding([]byte(testStr3), 16)

	cases := []struct {
		first    []byte
		excepted string
	}{
		{testCase1, testStr1},
		{testCase2, testStr2},
		{testCase3, testStr2},
		{testCase4, testStr3},
	}

	for _, c := range cases {
		result, _ := ZeroUnPadding(c.first)
		if strings.Compare(string(result), c.excepted) != 0 {
			t.Fatalf(
				"ZeroUnPadding function failed, unpadding string: %s, execpted: %s, result: %s",
				c.first,
				c.excepted,
				result,
			)
		}
	}
	t.Log("ZeroUnPadding function pass.")
}
